---
- name: Install exa when Ubuntu >= 22.04
  ansible.builtin.apt:
    state: present
    update_cache: true
    pkg:
      - exa
  become: true
  when: ansible_distribution == "Ubuntu" and ansible_distribution_version|float >= 22.04

- name: Install exa when Ubuntu < 22.04
  when: ansible_distribution == "Ubuntu" and ansible_distribution_version|float < 22.04
  block:
    - name: Install gnupg2 to add pub key
      ansible.builtin.apt:
        state: present
        update_cache: true
        pkg:
          - gnupg2
      become: true

    - name: Add apt-key for exa
      ansible.builtin.apt_key:
        url: https://keyserver.ubuntu.com/pks/lookup?op=get&search=0xF2C37BD8BDF01321549242C9AEC82AC78B65E182
        state: present
      become: true

    - name: Add repository for exa
      ansible.builtin.apt_repository:
        repo: 'deb https://ppa.launchpadcontent.net/spvkgn/exa/ubuntu {{ ansible_lsb.codename }} main'
        filename: config_files-exa
      become: true

    - name: Install exa
      ansible.builtin.apt:
        state: present
        update_cache: true
        pkg:
          - exa
      become: true

- name: Write block in file to rc files
  ansible.builtin.blockinfile:
    backup: true
    path: '{{ item }}'
    create: true
    marker: "# {mark} ANSIBLE MANAGED BLOCK exa"
    block: |
      if command -v exa >/dev/null; then
        # Changing "ls" to "exa"
        alias ls='exa -al --color=always --group-directories-first' # my preferred listing
        alias la='exa -a --color=always --group-directories-first'  # all files and dirs
        alias ll='exa -l --color=always --group-directories-first'  # long format
        alias lt='exa -aT --color=always --group-directories-first' # tree listing
        alias l.='exa -a | egrep "^\."'
      fi
  with_items:
    - '{{ ansible_user_dir }}/.zshrc'
    - '{{ ansible_user_dir }}/.bashrc'
