---
- name: Check for Starship command
  ansible.builtin.shell: command -v starship >/dev/null 2>&1
  no_log: true
  ignore_errors: yes
  changed_when: false
  register: installed

- name: Download Starship installer
  ansible.builtin.get_url:
    url: https://starship.rs/install.sh
    dest: /tmp/starship-installer.sh
    mode: '0744'
  when: installed.rc != 0
  register: download

- name: Install dependencies
  ansible.builtin.apt:
    state: present
    update_cache: true
    pkg:
      - wget
  become: true
  when: installed.rc != 0

- name: Run Starship install script
  ansible.builtin.shell: /tmp/starship-installer.sh --yes
  when: download.changed

- name: Remove the starship-installer.sh
  ansible.builtin.file:
    path: /tmp/starship-installer.sh
    state: absent

- name: Run zshrc role so Starship is used
  ansible.builtin.include_role:
    name: zsh
